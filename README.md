<h1 align="center">
  frames (Final name TK - suggestions appreciated!)
  <a href="https://www.npmjs.org/package/htm"><img src="https://img.shields.io/npm/v/@rdm/frames.svg?style=flat" alt="npm"></a>
</h1>

> **Important** - This is still in development, and not ready for production work.

`frames` is a [greenfield](https://en.wikipedia.org/wiki/Greenfield_project) take on responsive iframes in the spirit of [Pym.js](http://blog.apps.npr.org/pym.js/).

## Key features

- üêú Less than **1 kilobyte** for both parent and frame code
- üå¥ **Tree-shakable** by default - import only what you need to achieve responsiveness
- ‚ö°Ô∏è **Speaks [AMP](https://www.ampproject.org)**, compatible with [`amp-iframe`](https://www.ampproject.org/docs/reference/components/amp-iframe)
- ‚úâÔ∏è Full support for **frame-to-parent/parent-to-frame communication**

## Installation

This has not been deployed to `npm` yet - but you can install it directly from GitHub for now.

```sh
npm install rdmurphy/frames
```

## Usage

### From the **embedding** page (_framer_ or _parent_)

The page that contains the embeds needs to use the `Framer` class to set up instances for each embed.

Assume we have the following markup in our HTML:

```html
<div id="embed-container">Loading...</div>
```

Then, in our script:

```js
import { Framer } from '@rdm/frames';

const element = document.getElementById('embed-container');
const url = 'https://i-am-an-embed/';

const framer = new Framer(element, url);
// Now the iframe has been added to the page and is listening for height changes notifications from within the iframe
```

### From the **embedded** page (_frame_ or _child_)

While the code to setup the embedding page is similar to Pym's `Parent` class, the method for making the embedded page communicate with parent page is a little different.

Want to set it and forget it? You can import a function that sets up all the listeners and sends the initial height of the frame's content.

```js
import { initFrame } from '@rdm/frames';

// 1. Sends the initial frame's content height
// 2. Sets up a listener to send the height on load
// 3. Sets up a listener to send the height every time the frame resizes
initFrame();
```

However, you can set and use each of these independently depending on the needs of your frame's content.

```js
import {
  sendFrameHeight,
  sendHeightOnLoad,
  sendHeightOnResize,
} from '@rdm/frames';

// 1. Sends the initial frame's content height
sendFrameHeight();

// 2. Sets up a listener to send the height on load
sendHeightOnLoad();

// 3. Sets up a listener to send the height every time the frame resizes
sendHeightOnResize();

// This is identical to what initFrame() does!
```

Typically using `initFrame()` will be enough, but if you have code that will potentially change the height of the frame's content (like with an `<input>` or `<button>` press), you can use `sendFrameHeight()` to manually recalculate and send an update to the parent page.

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

- [Framer](#framer)
  - [Parameters](#parameters)
  - [sendMessage](#sendmessage)
    - [Parameters](#parameters-1)
    - [Examples](#examples)
- [sendMessage](#sendmessage-1)
  - [Parameters](#parameters-2)
  - [Examples](#examples-1)
- [sendHeightOnResize](#sendheightonresize)
  - [Examples](#examples-2)
- [sendHeightOnLoad](#sendheightonload)
  - [Examples](#examples-3)
- [sendFrameHeight](#sendframeheight)
  - [Parameters](#parameters-3)
  - [Examples](#examples-4)
- [createMessageListener](#createmessagelistener)
  - [Examples](#examples-5)
- [initFrame](#initframe)
  - [Examples](#examples-6)

### Framer

The Framer object to be called in the parent page.

#### Parameters

- `element` **[Element](https://developer.mozilla.org/docs/Web/API/Element)** the containing DOM element for the iframe
- `url` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** the URL to set as the `src` of the iframe
- `options` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** optional options to be set on the iframe (optional, default `{}`)
  - `options.allowfullscreen` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** toggles the `allowfullscreen` attribute (optional, default `false`)
  - `options.allowpaymentrequest` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** toggles the `allowpaymentrequest` attribute (optional, default `false`)
  - `options.name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** sets the `name` attribute
  - `options.referrerpolicy` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** sets the `referrerpolicy` attribute
  - `options.sandbox` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** sets the `sandbox` attribute (optional, default `'allow-scripts'`)

#### sendMessage

Sends an arbitrary message to the iframe.

##### Parameters

- `type` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**
- `data` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** (optional, default `{}`)

##### Examples

```javascript
framer.sendMessage('send-trigger', { info: 'important' });

// the frame recieves the following:
// {
//   sentinel: '<value>',
//   type: 'send-trigger',
//   info: 'important',
// }
```

### sendMessage

A wrapper around postMessage to normalize the message body. Automatically
includes the sentinel value.

#### Parameters

- `type` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Type of message being sent
- `data` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Any additional data to send (optional, default `{}`)

#### Examples

```javascript
sendMessage('send-trigger', { info: 'important' });

// parent page recieves the following:
// {
//   sentinel: '<value>',
//   type: 'send-trigger',
//   info: 'important',
// }
```

Returns **void**

### sendHeightOnResize

Sets up an event listener for the resize event that sends the new frame
height to the parent.

#### Examples

```javascript
// every time the frame is resized, tell the parent page what its new height is
sendHeightOnResize();
```

Returns **void**

### sendHeightOnLoad

Sets up an event listener for the load event that sends the new frame
height to the parent. Automatically removes itself once fired.

#### Examples

```javascript
// once the frame's load event is fired, tell the parent page its new height
sendHeightOnLoad();
```

Returns **void**

### sendFrameHeight

Sends the current document's height or provided value to the parent window
using postMessage.

#### Parameters

- `height` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** The height to pass to the parent page, is determined automatically if not passed (optional, default `getDocumentHeight()`)

#### Examples

```javascript
// Uses the document's height to tell the parent frame
sendFrameHeight();

// Pass a height you've determined in another way
sendFrameHeight(500);
```

Returns **void**

### createMessageListener

Creates an observable that listens for messages from the parent page. Only
needed for specialized cases. Automatically validates against the sentinel
value.

#### Examples

```javascript
const observer = createMessageListener();

observer.on('special-message', data => {
  console.log(data); // the message from the parent page
});
```

Returns **Mitt** An instance of `mitt`

### initFrame

A helper for running the usual functions for setting up a frame.

Automatically calls sendFrameHeight, sendHeightOnLoad and sendHeightOnResize.

#### Examples

```javascript
initFrame();
```

Returns **void**

## License

MIT
